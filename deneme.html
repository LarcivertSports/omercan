<!doctype html>

<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Basit HLS Yayın Sitesi - Ömercan</title>
  <!-- hls.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js"></script>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#2dd4bf}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(180deg,#071026 0%,#071024 100%);color:#e6eef6}
    .container{max-width:1100px;margin:24px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    input[type=text]{padding:8px;border-radius:8px;border:1px solid #213142;background:#071425;color:inherit;min-width:260px}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#042226;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    video{width:100%;height:200px;background:#000;border-radius:8px;display:block}
    .meta{display:flex;align-items:center;justify-content:space-between;margin-top:8px;gap:8px}
    .meta .title{font-size:14px;color:#d8e6f2;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .meta .actions{display:flex;gap:6px}
    .small{padding:6px 8px;background:transparent;border:1px solid rgba(255,255,255,0.04);border-radius:8px;color:var(--muted);cursor:pointer}
    .danger{background:transparent;border:1px solid rgba(255,0,60,0.12);color:#ff6b8a}
    footer{margin-top:20px;color:var(--muted);font-size:13px}
    @media (max-width:420px){video{height:140px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Basit HLS Yayın Sitesi</h1>
        <div style="color:var(--muted);font-size:13px;margin-top:6px">HLS (m3u8) yayınlarını buraya yapıştır — canlı önizleme ve gömme kodu üretir.</div>
      </div>
      <div style="text-align:right;color:var(--muted);font-size:13px">Yerel kayıt: tarayıcıda <code>localStorage</code></div>
    </header><div class="controls">
  <input id="url" type="text" placeholder="HLS yayın URL (ör: https://example.com/stream.m3u8)" />
  <input id="title" type="text" placeholder="Yayın başlığı (opsiyonel)" />
  <button id="addBtn">Yayın Ekle</button>
  <button id="clearBtn" class="small">Tümünü Temizle</button>
  <button id="exportBtn" class="small">Listeyi İndir (JSON)</button>
</div>

<div id="grid" class="grid" aria-live="polite"></div>

<footer>
  İpucu: Bu tek dosyalık sayfayı GitHub Pages veya herhangi bir statik sunucuya koyarak yayınlayabilirsiniz. Tarayıcınız HLS'i natif desteklemiyorsa <code>hls.js</code> yardımıyla oynatılır.
</footer>

  </div>  <script>
    // Basit HLS grid app
    const urlEl = document.getElementById('url')
    const titleEl = document.getElementById('title')
    const addBtn = document.getElementById('addBtn')
    const grid = document.getElementById('grid')
    const clearBtn = document.getElementById('clearBtn')
    const exportBtn = document.getElementById('exportBtn')

    let streams = JSON.parse(localStorage.getItem('hls_streams') || '[]')

    function save(){ localStorage.setItem('hls_streams', JSON.stringify(streams)) }

    function createCard(stream){
      const card = document.createElement('div')
      card.className = 'card'

      const video = document.createElement('video')
      video.autoplay = true
      video.muted = true
      video.playsInline = true
      video.controls = false
      video.setAttribute('data-src', stream.url)

      // Attach hls if needed
      function attach(){
        if(video.canPlayType('application/vnd.apple.mpegurl')){
          // Native HLS
          video.src = stream.url
          video.play().catch(()=>{})
        } else if(window.Hls){
          const hls = new Hls()
          hls.loadSource(stream.url)
          hls.attachMedia(video)
          hls.on(Hls.Events.MANIFEST_PARSED, function() {
            video.play().catch(()=>{})
          })
          // store reference for cleanup
          video._hls = hls
        } else {
          // no hls support
          const msg = document.createElement('div')
          msg.textContent = 'Tarayıcı HLS desteklemiyor.'
          card.appendChild(msg)
        }
      }

      attach()

      const meta = document.createElement('div')
      meta.className = 'meta'

      const tdiv = document.createElement('div')
      tdiv.className = 'title'
      tdiv.textContent = stream.title || stream.url

      const actions = document.createElement('div')
      actions.className = 'actions'

      const playBtn = document.createElement('button')
      playBtn.className = 'small'
      playBtn.textContent = 'Küçük Oynat'
      playBtn.onclick = ()=>{
        if(video.paused) video.play().catch(()=>{})
        else video.pause()
      }

      const previewBtn = document.createElement('button')
      previewBtn.className = 'small'
      previewBtn.textContent = 'Önizlemede Aç'
      previewBtn.onclick = ()=>{
        // open full player in new window with embed code
        const embed = generateEmbed(stream)
        const w = window.open('', '_blank')
        w.document.write(`<!doctype html><meta charset="utf-8"><title>${escapeHtml(stream.title||'Yayın')}</title>${embed}<style>body{margin:0;background:#000;height:100vh}video{width:100%;height:100vh}</style>`)w.document.close()
  }

  const embedBtn = document.createElement('button')
  embedBtn.className = 'small'
  embedBtn.textContent = 'Gömme Kodu'
  embedBtn.onclick = ()=>{
    const code = generateEmbed(stream)
    prompt('Gömme HTML kodu (kopyalayın):', code)
  }

  const removeBtn = document.createElement('button')
  removeBtn.className = 'small danger'
  removeBtn.textContent = 'Kaldır'
  removeBtn.onclick = ()=>{
    // cleanup hls instance
    if(video._hls) try{ video._hls.destroy() }catch(e){}
    streams = streams.filter(s => s.id !== stream.id)
    save(); render()
  }

  actions.appendChild(playBtn)
  actions.appendChild(previewBtn)
  actions.appendChild(embedBtn)
  actions.appendChild(removeBtn)

  meta.appendChild(tdiv)
  meta.appendChild(actions)

  card.appendChild(video)
  card.appendChild(meta)

  return card
}

function generateID(){ return 's_'+Math.random().toString(36).slice(2,9) }

function generateEmbed(stream){
  // Simple responsive iframe + video player (uses hls.js from CDN)
  const escapedUrl = escapeHtml(stream.url)
  const title = escapeHtml(stream.title || '')
  return `\n<div id=\"player\"></div>\n<script src=\"https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js\"></script>\n<video id=\"v\" controls playsinline style=\"width:100%;height:auto;max-height:90vh;background:#000\" poster=\"\">Your browser does not support HTML5 video.</video>\n<script>\n(function(){\n  const url=\"${escapedUrl}\"; const v=document.getElementById('v');\n  if(v.canPlayType('application/vnd.apple.mpegurl')){ v.src=url } else if(window.Hls){ const h=new Hls(); h.loadSource(url); h.attachMedia(v);} else { console.error('No HLS support'); }\n})();\n</script>\n`
}

function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c] }) }

function render(){
  grid.innerHTML = ''
  if(streams.length===0){
    grid.innerHTML = '<div style="color:var(--muted);padding:18px">Henüz yayın eklenmedi. Üstteki alanlara HLS URL yapıştırıp "Yayın Ekle" butonuna basın.</div>'
    return
  }
  streams.forEach(s => grid.appendChild(createCard(s)))
}

addBtn.onclick = ()=>{
  const url = urlEl.value.trim()
  if(!url) return alert('Lütfen HLS (m3u8) URL girin.')
  const title = titleEl.value.trim()
  const entry = { id: generateID(), url, title }
  streams.unshift(entry)
  save(); render()
  urlEl.value = ''
  titleEl.value = ''
}

clearBtn.onclick = ()=>{
  if(!confirm('Tüm yayınları silmek istediğinize emin misiniz?')) return
  streams = []
  save(); render()
}

exportBtn.onclick = ()=>{
  const blob = new Blob([JSON.stringify(streams, null, 2)], {type:'application/json'})
  const a = document.createElement('a')
  a.href = URL.createObjectURL(blob)
  a.download = 'hls-streams.json'
  a.click()
}

// initial render
render()

// cleanup Hls instances before unloading
window.addEventListener('beforeunload', ()=>{
  document.querySelectorAll('video').forEach(v=>{ if(v._hls) try{ v._hls.destroy() }catch(e){} })
})

  </script>
</body>
</html>
