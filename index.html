
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Minecraft Web - Mobil & PC</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; user-select: none; -webkit-user-select: none; }
        
        /* Ortak Arayüz */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.8); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 10;
        }

        /* Masaüstü Talimatları */
        #desktop-instructions {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: white; background: rgba(0, 0, 0, 0.6);
            padding: 20px; border-radius: 10px; cursor: pointer; display: none;
        }

        /* Mobil Kontroller (Varsayılan gizli) */
        #mobile-controls {
            display: none; position: absolute; bottom: 20px; left: 0; width: 100%; height: 100%; pointer-events: none;
        }

        /* Joystick Alanı */
        #joystick-zone {
            position: absolute; bottom: 50px; left: 50px; width: 120px; height: 120px;
            background: rgba(255, 255, 255, 0.1); border-radius: 50%; pointer-events: auto;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        #joystick-knob {
            position: absolute; top: 50%; left: 50%; width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.5); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
        }

        /* Sağ Taraf Butonları */
        .action-btn {
            position: absolute; width: 70px; height: 70px; background: rgba(0, 0, 0, 0.3);
            border: 2px solid white; border-radius: 50%; color: white; font-weight: bold;
            display: flex; align-items: center; justify-content: center; font-size: 14px;
            pointer-events: auto; touch-action: manipulation;
        }
        .action-btn:active { background: rgba(255, 255, 255, 0.4); }

        #btn-jump { bottom: 140px; right: 40px; }
        #btn-action { bottom: 50px; right: 40px; width: 80px; height: 80px; background: rgba(255, 0, 0, 0.4); }
        #btn-mode { bottom: 240px; right: 40px; font-size: 12px; }

        /* Sağ taraf dokunmatik alan (Kamera çevirme) */
        #touch-look-zone {
            position: absolute; top: 0; right: 0; width: 60%; height: 70%; 
            pointer-events: auto; z-index: 5;
        }

    </style>
</head>
<body>

    <div id="crosshair"></div>

    <div id="desktop-instructions">
        <h1>Başlamak için Tıkla</h1>
        <p>W, A, S, D - Hareket</p>
        <p>Mouse - Bakış</p>
        <p>Sol Tık - Kır | Sağ Tık - Koy</p>
    </div>

    <div id="mobile-controls">
        <div id="touch-look-zone"></div> <div id="joystick-zone">
            <div id="joystick-knob"></div>
        </div>

        <div id="btn-jump" class="action-btn">ZIPLA</div>
        <div id="btn-mode" class="action-btn" style="background:orange;">MOD:<br>KIR</div>
        <div id="btn-action" class="action-btn">YAP</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- DEĞİŞKENLER ---
        let camera, scene, renderer, controls;
        let raycaster;
        let objects = [];
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;
        let prevTime = performance.now();
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        
        // Mobil Kontrol Değişkenleri
        let isMobile = false;
        let joystickActive = false;
        let joystickData = { x: 0, y: 0 };
        let touchLookLastX = 0;
        let touchLookLastY = 0;
        let buildMode = "DESTROY"; // DESTROY veya BUILD

        // Blok Materyalleri
        const cubeGeo = new THREE.BoxGeometry(50, 50, 50);
        const cubeMat = new THREE.MeshLambertMaterial({ color: 0xfeb74c });
        
        init();
        animate();

        function init() {
            // Cihaz Tespiti
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            // Sahne
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0xffffff, 0, 750);

            // Kamera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
            camera.rotation.order = 'YXZ'; // Kamera dönüş sırası önemli

            // Işık
            const light = new THREE.HemisphereLight(0xeeeeff, 0x777788, 0.75);
            light.position.set(0.5, 1, 0.75);
            scene.add(light);

            // Zemin
            const floorGeometry = new THREE.PlaneGeometry(2000, 2000, 100, 100);
            floorGeometry.rotateX(-Math.PI / 2);
            const floorMaterial = new THREE.MeshBasicMaterial({ color: 0x4aa346 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            scene.add(floor);
            objects.push(floor);

            // Raycaster
            raycaster = new THREE.Raycaster();

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // KONTROLLERİN AYARLANMASI
            if (isMobile) {
                setupMobileControls();
                camera.position.y = 30; // Mobilde biraz daha yukarıdan başla
            } else {
                setupDesktopControls();
                camera.position.y = 10;
            }

            window.addEventListener('resize', onWindowResize);
        }

        // --- MASAÜSTÜ KONTROLLERİ ---
        function setupDesktopControls() {
            document.getElementById('desktop-instructions').style.display = 'block';
            controls = new PointerLockControls(camera, document.body);

            const instructions = document.getElementById('desktop-instructions');
            instructions.addEventListener('click', () => controls.lock());
            controls.addEventListener('lock', () => instructions.style.display = 'none');
            controls.addEventListener('unlock', () => instructions.style.display = 'block');

            scene.add(controls.getObject());

            // Klavye
            document.addEventListener('keydown', (event) => {
                switch (event.code) {
                    case 'ArrowUp': case 'KeyW': moveForward = true; break;
                    case 'ArrowLeft': case 'KeyA': moveLeft = true; break;
                    case 'ArrowDown': case 'KeyS': moveBackward = true; break;
                    case 'ArrowRight': case 'KeyD': moveRight = true; break;
                    case 'Space': if (canJump) velocity.y += 350; canJump = false; break;
                }
            });
            document.addEventListener('keyup', (event) => {
                switch (event.code) {
                    case 'ArrowUp': case 'KeyW': moveForward = false; break;
                    case 'ArrowLeft': case 'KeyA': moveLeft = false; break;
                    case 'ArrowDown': case 'KeyS': moveBackward = false; break;
                    case 'ArrowRight': case 'KeyD': moveRight = false; break;
                }
            });

            // Mouse Tık
            document.addEventListener('mousedown', (event) => {
                if (!controls.isLocked) return;
                if (event.button === 0) interactBlock('DESTROY'); // Sol tık
                if (event.button === 2) interactBlock('BUILD');   // Sağ tık
            });
        }

        // --- MOBİL KONTROLLERİ ---
        function setupMobileControls() {
            document.getElementById('mobile-controls').style.display = 'block';
            scene.add(camera); // Controls kullanmıyoruz, kamerayı doğrudan ekle

            // Joystick Mantığı
            const joyZone = document.getElementById('joystick-zone');
            const joyKnob = document.getElementById('joystick-knob');
            
            joyZone.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickActive = true;
                updateJoystick(e.touches[0]);
            }, {passive: false});

            joyZone.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (joystickActive) updateJoystick(e.touches[0]);
            }, {passive: false});

            joyZone.addEventListener('touchend', (e) => {
                e.preventDefault();
                joystickActive = false;
                joystickData = { x: 0, y: 0 };
                joyKnob.style.transform = `translate(-50%, -50%)`;
            });

            function updateJoystick(touch) {
                const rect = joyZone.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                let dx = touch.clientX - centerX;
                let dy = touch.clientY - centerY;
                
                // Mesafeyi sınırla
                const distance = Math.min(Math.hypot(dx, dy), 35);
                const angle = Math.atan2(dy, dx);
                
                dx = Math.cos(angle) * distance;
                dy = Math.sin(angle) * distance;

                joyKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
                
                // Hız verilerini normalize et (-1 ile 1 arası)
                joystickData.x = dx / 35; 
                joystickData.y = dy / 35;
            }

            // Kamera Bakış (Sağ tarafı kaydırarak)
            const lookZone = document.getElementById('touch-look-zone');
            lookZone.addEventListener('touchstart', (e) => {
                touchLookLastX = e.touches[0].clientX;
                touchLookLastY = e.touches[0].clientY;
            });

            lookZone.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const sensitivity = 0.005;
                
                const movementX = touch.clientX - touchLookLastX;
                const movementY = touch.clientY - touchLookLastY;

                camera.rotation.y -= movementX * sensitivity;
                camera.rotation.x -= movementY * sensitivity;
                
                // Yukarı/Aşağı bakışı sınırla (Takla atmaması için)
                camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));

                touchLookLastX = touch.clientX;
                touchLookLastY = touch.clientY;
            });

            // Butonlar
            document.getElementById('btn-jump').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (canJump) { velocity.y += 350; canJump = false; }
            });

            const btnAction = document.getElementById('btn-action');
            const btnMode = document.getElementById('btn-mode');
            
            // Mod Değiştir (Kır / Yap)
            btnMode.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (buildMode === 'DESTROY') {
                    buildMode = 'BUILD';
                    btnMode.innerHTML = "MOD:<br>YAP";
                    btnMode.style.background = "#4aa346"; // Yeşil
                    btnAction.innerText = "KOY";
                    btnAction.style.background = "rgba(0, 255, 0, 0.4)";
                } else {
                    buildMode = 'DESTROY';
                    btnMode.innerHTML = "MOD:<br>KIR";
                    btnMode.style.background = "orange";
                    btnAction.innerText = "KIR";
                    btnAction.style.background = "rgba(255, 0, 0, 0.4)";
                }
            });

            // Eylem Butonu
            btnAction.addEventListener('touchstart', (e) => {
                e.preventDefault();
                interactBlock(buildMode);
            });
        }

        // --- BLOK ETKİLEŞİMİ (ORTAK) ---
        function interactBlock(mode) {
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(objects, false);

            if (intersects.length > 0) {
                const intersect = intersects[0];

                if (mode === 'DESTROY') {
                    if (intersect.object !== objects[0]) { // Zemini silme
                        scene.remove(intersect.object);
                        objects.splice(objects.indexOf(intersect.object), 1);
                    }
                } else if (mode === 'BUILD') {
                    const voxel = new THREE.Mesh(cubeGeo, cubeMat);
                    voxel.position.copy(intersect.point).add(intersect.face.normal);
                    voxel.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25);
                    scene.add(voxel);
                    objects.push(voxel);
                }
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;
            velocity.y -= 9.8 * 100.0 * delta; // Yerçekimi

            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize(); // Çapraz gidince hızlanmaması için

            // Hız Hesaplama (Masaüstü ve Mobil Ayrımı)
            if (isMobile) {
                // Mobilde Joystick verisini kullan
                // Joystick ileri (negatif Y), geri (pozitif Y) mantığında çalışır
                if (joystickActive) {
                    velocity.z += joystickData.y * 400.0 * delta; // İleri/Geri
                    velocity.x += joystickData.x * 400.0 * delta; // Sağ/Sol
                }
            } else {
                // Masaüstü WASD
                if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;
            }

            // Hareketi Uygula
            if (isMobile) {
                // Mobilde PointerLock yok, hareketi kameranın baktığı yöne (y-axis rotation) göre hesapla
                // Basit trigonometri: Kameranın baktığı açıya göre forward/right vektörleri
                const angle = camera.rotation.y;
                const speedZ = -velocity.z * delta;
                const speedX = -velocity.x * delta;

                // İleri gitmek kameranın baktığı yöne gitmektir
                camera.position.x -= Math.sin(angle) * speedZ;
                camera.position.z -= Math.cos(angle) * speedZ;
                
                // Yan gitmek (Strafe)
                camera.position.x -= Math.cos(angle) * speedX;
                camera.position.z += Math.sin(angle) * speedX;

                camera.position.y += (velocity.y * delta);
            } else {
                // Masaüstü (PointerLockControls kendi içinde hesaplar)
                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                controls.getObject().position.y += (velocity.y * delta);
            }

            // Zemin Çarpışma Kontrolü (Basit)
            let objHeight = isMobile ? camera.position.y : controls.getObject().position.y;
            
            if (objHeight < 10) {
                velocity.y = 0;
                if (isMobile) camera.position.y = 10;
                else controls.getObject().position.y = 10;
                canJump = true;
            }

            prevTime = time;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
 
