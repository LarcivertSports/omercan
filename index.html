<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Larcivert Oynatıcı V3</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body {
            background-color: #121212;
            color: #fff;
            font-family: sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Oynatıcı Kısmı */
        #player-wrapper {
            background: black;
            width: 100%;
            height: 40vh; /* Mobilde ekranın %40'ı */
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        video {
            width: 100%;
            height: 100%;
        }

        /* Liste Kısmı */
        #list-wrapper {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .item {
            background: #1e1e1e;
            padding: 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
            border-left: 4px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item:hover { background: #333; }
        .item-name { font-weight: bold; font-size: 14px; }
        .item-url { font-size: 10px; color: #888; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 200px; }
        
        #status {
            padding: 10px;
            text-align: center;
            background: #333;
            font-size: 12px;
        }
        .error { color: #ff4444; }
        .success { color: #00C851; }

        @media (min-width: 768px) {
            body { flex-direction: row; }
            #player-wrapper { width: 60%; height: 100vh; }
            #list-wrapper { width: 40%; }
        }
    </style>
</head>
<body>

    <div id="player-wrapper">
        <video id="video" controls autoplay playsinline></video>
    </div>

    <div id="list-wrapper">
        <div id="status">Veriler Yükleniyor...</div>
        <div id="content"></div>
    </div>

    <script>
        // HEDEF DOSYA ADRESİ
        const TARGET_URL = "https://raw.githubusercontent.com/LarcivertSports/LarcivertSports/master/repo.json";
        
        // CORS Proxy (GitHub raw engeline takılmamak için)
        const PROXY_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(TARGET_URL);

        const video = document.getElementById('video');
        const contentDiv = document.getElementById('content');
        const statusDiv = document.getElementById('status');

        // Oynatma Fonksiyonu
        function playStream(url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.addEventListener('loadedmetadata', () => video.play());
            } else {
                video.src = url;
                video.play();
            }
        }

        // Derinlemesine Arama Fonksiyonu (JSON yapısı ne olursa olsun link bulur)
        function findLinks(obj, found = []) {
            if (!obj) return found;

            // Eğer obje bir dizi ise içini dön
            if (Array.isArray(obj)) {
                obj.forEach(item => findLinks(item, found));
            } 
            // Eğer obje ise anahtarlarına bak
            else if (typeof obj === 'object') {
                // Olası İsim ve Link alanlarını tahmin et
                let name = obj.name || obj.title || obj.channel_name || obj.kanal || "İsimsiz Kanal";
                let url = obj.url || obj.stream || obj.link || obj.source || obj.adres || obj.file;

                // Eğer doğrudan url anahtarı yoksa ama değerlerden biri http ile başlıyorsa onu yakala
                if (!url) {
                    for (let key in obj) {
                        if (typeof obj[key] === 'string' && obj[key].startsWith('http')) {
                            url = obj[key];
                            if(name === "İsimsiz Kanal") name = key; // İsmi anahtardan al
                            break;
                        }
                    }
                }

                if (url && typeof url === 'string' && url.startsWith('http')) {
                    found.push({ name: name, url: url });
                } else {
                    // İç içe klasör varsa dalmaya devam et
                    for (let key in obj) {
                        findLinks(obj[key], found);
                    }
                }
            }
            return found;
        }

        // Veriyi Çek
        fetch(PROXY_URL)
            .then(response => {
                if (!response.ok) throw new Error("HTTP Hatası: " + response.status);
                return response.json();
            })
            .then(data => {
                console.log("Ham Veri:", data); // Konsoldan kontrol için
                const links = findLinks(data);

                if (links.length === 0) {
                    statusDiv.innerHTML = "<span class='error'>Veri çekildi ama içinde oynatılabilir link bulunamadı.</span>";
                    return;
                }

                statusDiv.innerHTML = `<span class='success'>${links.length} adet yayın bulundu.</span>`;
                
                // Listeyi Oluştur
                links.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class='item-name'>${item.name}</div>
                        <div class='item-url'>▶ Oynat</div>
                    `;
                    div.onclick = () => {
                        playStream(item.url);
                        window.scrollTo(0, 0); // Oynatıcıya git
                    };
                    contentDiv.appendChild(div);
                });
            })
            .catch(err => {
                console.error(err);
                statusDiv.innerHTML = `<span class='error'>HATA: ${err.message}<br>Lütfen internet bağlantınızı kontrol edin.</span>`;
            });

    </script>
</body>
</html>

