<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minecraft Web v3 - MenÃ¼lÃ¼</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; user-select: none; -webkit-user-select: none; touch-action: none; background: #000; }
        
        /* --- GÄ°RÄ°Åž EKRANI (MENÃœ) --- */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.8)), url('https://assets.codepen.io/108082/jungle.jpg'); /* Arka plan gÃ¶rseli */
            background-size: cover;
            background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; color: white;
        }
        #start-screen h1 { font-size: 40px; text-shadow: 2px 2px 0 #000; margin-bottom: 30px; }
        .mode-btn {
            background: #4aa346; color: white; border: 2px solid white;
            padding: 15px 40px; font-size: 20px; font-weight: bold; margin: 10px;
            cursor: pointer; border-radius: 8px; width: 250px; text-align: center;
            box-shadow: 0 4px 0 #2e6b2b; transition: transform 0.1s;
        }
        .mode-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #2e6b2b; }
        .mode-btn.pc { background: #3b86db; box-shadow: 0 4px 0 #265a96; }
        .mode-btn.pc:active { box-shadow: 0 0 0 #265a96; }

        /* --- OYUN ARAYÃœZÃœ --- */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.9); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 10;
            display: none; /* Oyun baÅŸlayana kadar gizli */
        }

        /* Mobil Kontroller */
        #mobile-controls {
            display: none; position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20;
        }

        /* Joystick */
        #joystick-zone {
            position: absolute; bottom: 50px; left: 40px; width: 140px; height: 140px;
            background: rgba(255, 255, 255, 0.15); border-radius: 50%; pointer-events: auto;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }
        #joystick-knob {
            position: absolute; top: 50%; left: 50%; width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.8); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* Butonlar */
        .action-container {
            position: absolute; bottom: 40px; right: 30px;
            display: flex; flex-direction: column; gap: 15px; align-items: flex-end;
            pointer-events: auto;
        }
        .game-btn {
            width: 70px; height: 70px; background: rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(255,255,255,0.8); border-radius: 50%;
            color: white; font-weight: bold; font-size: 14px;
            display: flex; align-items: center; justify-content: center; text-align: center;
            touch-action: manipulation; user-select: none;
        }
        .game-btn:active { background: rgba(255,255,255,0.3); transform: scale(0.95); }
        
        #btn-action { width: 90px; height: 90px; font-size: 18px; background: rgba(255, 60, 60, 0.5); border-color: #ffaaaa; }
        #btn-mode { background: orange; border-color: #ffdcb0; color: #333; }
        
        /* Dokunmatik Alan (Kamera Ã‡evirme) */
        #touch-look-zone {
            position: absolute; top: 0; right: 0; width: 50%; height: 100%;
            pointer-events: auto; z-index: 5;
        }

    </style>
</head>
<body>

    <div id="start-screen">
        <h1>WEB MINECRAFT</h1>
        <div class="mode-btn pc" onclick="startGame('pc')">ðŸ’» BÄ°LGÄ°SAYAR</div>
        <div class="mode-btn" onclick="startGame('mobile')">ðŸ“± MOBÄ°L (DOKUNMATÄ°K)</div>
        <p style="margin-top:20px; font-size:12px; color:#ccc;">CihazÄ±na uygun olanÄ± seÃ§.</p>
    </div>

    <div id="crosshair"></div>

    <div id="mobile-controls">
        <div id="touch-look-zone"></div>
        <div id="joystick-zone"><div id="joystick-knob"></div></div>
        
        <div class="action-container">
            <div id="btn-mode" class="game-btn">MOD<br>KIR</div>
            <div id="btn-jump" class="game-btn">ZIPLA</div>
            <div id="btn-action" class="game-btn">KIR</div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // GLOBAL DEÄžÄ°ÅžKENLER
        let camera, scene, renderer, controls;
        let raycaster;
        let objects = []; // KÄ±rÄ±labilir nesneler
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;
        let prevTime = performance.now();
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        const BLOCK_SIZE = 50;

        // Oyun Modu DeÄŸiÅŸkenleri
        window.gameMode = null; // 'pc' veya 'mobile'
        let buildMode = "DESTROY"; 
        
        // Mobil Joystick
        let joystickActive = false;
        let joystickData = { x: 0, y: 0 };
        let touchLookLastX = 0, touchLookLastY = 0;

        // Materyaller
        const cubeGeo = new THREE.BoxGeometry(BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
        const matBuild = new THREE.MeshLambertMaterial({ color: 0xfeb74c });
        const matGrass = new THREE.MeshLambertMaterial({ color: 0x4aa346 });
        const matDirt = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
        const matStone = new THREE.MeshLambertMaterial({ color: 0x808080 });
        const matWood = new THREE.MeshLambertMaterial({ color: 0x5C4033 });
        const matLeaf = new THREE.MeshLambertMaterial({ color: 0x228B22 });

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 100, 900);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
            camera.rotation.order = 'YXZ';

            const ambientLight = new THREE.AmbientLight(0xcccccc);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(50, 200, 100);
            scene.add(dirLight);

            // ZEMÄ°N VE DÃœNYA
            const bedRockGeo = new THREE.PlaneGeometry(3000, 3000);
            bedRockGeo.rotateX(-Math.PI / 2);
            const bedRockMat = new THREE.MeshBasicMaterial({ color: 0x3a8336 });
            const bedRock = new THREE.Mesh(bedRockGeo, bedRockMat);
            bedRock.position.y = -BLOCK_SIZE/2 - 1;
            scene.add(bedRock);

            generateWorld();

            raycaster = new THREE.Raycaster();
            raycaster.far = 400;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            window.addEventListener('resize', onWindowResize);
        }

        // --- GLOBAL START FONKSÄ°YONU ---
        window.startGame = function(mode) {
            window.gameMode = mode;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('crosshair').style.display = 'block';

            if (mode === 'pc') {
                setupDesktopControls();
                camera.position.set(0, BLOCK_SIZE * 2, 0);
            } else {
                setupMobileControls();
                camera.position.set(0, BLOCK_SIZE * 3, 0); // Mobilde biraz daha yÃ¼ksek baÅŸla
            }
        };

        // --- DÃœNYA OLUÅžTURUCU ---
        function generateWorld() {
            const size = 12;
            for (let x = -size; x <= size; x++) {
                for (let z = -size; z <= size; z++) {
                    // Ã‡imen Zemin
                    placeBlock(x, 0, z, matGrass);
                    
                    // Rastgele yÃ¼kseltiler
                    if (Math.random() > 0.8) placeBlock(x, 1, z, matGrass);

                    // Rastgele AÄŸaÃ§lar
                    if (Math.random() < 0.05) {
                        createTree(x, 1, z);
                    }
                    // Rastgele TaÅŸlar
                    if (Math.random() < 0.05) {
                        placeBlock(x, 1, z, matStone);
                    }
                }
            }
        }

        function createTree(x, y, z) {
            for(let i=0; i<3; i++) placeBlock(x, y+i, z, matWood);
            for(let lx=-1; lx<=1; lx++) {
                for(let lz=-1; lz<=1; lz++) {
                    placeBlock(x+lx, y+2, z+lz, matLeaf);
                    placeBlock(x+lx, y+3, z+lz, matLeaf);
                }
            }
            placeBlock(x, y+4, z, matLeaf);
        }

        function placeBlock(x, y, z, material) {
            const voxel = new THREE.Mesh(cubeGeo, material);
            voxel.position.set(x * BLOCK_SIZE, y * BLOCK_SIZE, z * BLOCK_SIZE);
            scene.add(voxel);
            objects.push(voxel);
        }

        // --- MASAÃœSTÃœ KONTROLLERÄ° ---
        function setupDesktopControls() {
            controls = new PointerLockControls(camera, document.body);
            document.body.addEventListener('click', () => controls.lock());
            scene.add(controls.getObject());

            document.addEventListener('keydown', (e) => {
                switch (e.code) {
                    case 'KeyW': moveForward = true; break;
                    case 'KeyA': moveLeft = true; break;
                    case 'KeyS': moveBackward = true; break;
                    case 'KeyD': moveRight = true; break;
                    case 'Space': if (canJump) velocity.y += 350; canJump = false; break;
                }
            });
            document.addEventListener('keyup', (e) => {
                switch (e.code) {
                    case 'KeyW': moveForward = false; break;
                    case 'KeyA': moveLeft = false; break;
                    case 'KeyS': moveBackward = false; break;
                    case 'KeyD': moveRight = false; break;
                }
            });
            document.addEventListener('mousedown', (e) => {
                if (!controls.isLocked) return;
                if (e.button === 0) interactBlock('DESTROY');
                if (e.button === 2) interactBlock('BUILD');
            });
        }

        // --- MOBÄ°L KONTROLLERÄ° (MANUEL AKTÄ°F) ---
        function setupMobileControls() {
            document.getElementById('mobile-controls').style.display = 'block';
            scene.add(camera);

            const joyZone = document.getElementById('joystick-zone');
            const joyKnob = document.getElementById('joystick-knob');
            const joyRadius = 70; // 140px width / 2

            // Joystick Eventleri
            joyZone.addEventListener('touchstart', (e) => {
                e.preventDefault(); joystickActive = true; updateJoystick(e.touches[0]);
            }, {passive: false});
            
            joyZone.addEventListener('touchmove', (e) => {
                e.preventDefault(); if(joystickActive) updateJoystick(e.touches[0]);
            }, {passive: false});

            joyZone.addEventListener('touchend', (e) => {
                e.preventDefault(); joystickActive = false;
                joystickData = {x:0, y:0};
                joyKnob.style.transform = `translate(-50%, -50%)`;
            });

            function updateJoystick(touch) {
                const rect = joyZone.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                let dx = touch.clientX - centerX;
                let dy = touch.clientY - centerY;
                
                const dist = Math.min(Math.hypot(dx, dy), joyRadius);
                const angle = Math.atan2(dy, dx);
                
                const moveX = Math.cos(angle) * dist;
                const moveY = Math.sin(angle) * dist;
                
                joyKnob.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;
                joystickData.x = moveX / joyRadius;
                joystickData.y = moveY / joyRadius;
            }

            // Kamera BakÄ±ÅŸ
            const lookZone = document.getElementById('touch-look-zone');
            lookZone.addEventListener('touchstart', (e) => { 
                touchLookLastX = e.touches[0].clientX; 
                touchLookLastY = e.touches[0].clientY; 
            }, {passive: false});
            
            lookZone.addEventListener('touchmove', (e) => {
                e.preventDefault(); // Sayfa kaymasÄ±nÄ± engelle
                const touch = e.touches[0];
                const sensitivity = 0.005;
                camera.rotation.y -= (touch.clientX - touchLookLastX) * sensitivity;
                camera.rotation.x -= (touch.clientY - touchLookLastY) * sensitivity;
                camera.rotation.x = Math.max(-Math.PI/2.2, Math.min(Math.PI/2.2, camera.rotation.x));
                
                touchLookLastX = touch.clientX;
                touchLookLastY = touch.clientY;
            }, {passive: false});

            // Buton Ä°ÅŸlevleri
            document.getElementById('btn-jump').addEventListener('touchstart', (e) => {
                e.preventDefault(); if(canJump) { velocity.y += 350; canJump = false; }
            });

            const btnMode = document.getElementById('btn-mode');
            const btnAction = document.getElementById('btn-action');

            btnMode.addEventListener('touchstart', (e) => {
                e.preventDefault();
                buildMode = (buildMode === 'DESTROY') ? 'BUILD' : 'DESTROY';
                
                if (buildMode === 'BUILD') {
                    btnMode.innerHTML = "MOD<br>YAP"; btnMode.style.background = "#4aa346";
                    btnAction.innerText = "KOY"; btnAction.style.background = "rgba(100, 255, 100, 0.5)";
                } else {
                    btnMode.innerHTML = "MOD<br>KIR"; btnMode.style.background = "orange";
                    btnAction.innerText = "KIR"; btnAction.style.background = "rgba(255, 60, 60, 0.5)";
                }
            });

            btnAction.addEventListener('touchstart', (e) => {
                e.preventDefault();
                interactBlock(buildMode);
            });
        }

        // --- ORTAK Ä°ÅžLEVLER ---
        function interactBlock(mode) {
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(objects, false);

            if (intersects.length > 0) {
                const intersect = intersects[0];
                if (mode === 'DESTROY') {
                    scene.remove(intersect.object);
                    objects.splice(objects.indexOf(intersect.object), 1);
                } else {
                    const voxel = new THREE.Mesh(cubeGeo, matBuild);
                    voxel.position.copy(intersect.point).add(intersect.face.normal);
                    voxel.position.divideScalar(BLOCK_SIZE).floor().multiplyScalar(BLOCK_SIZE).addScalar(BLOCK_SIZE/2);
                    scene.add(voxel);
                    objects.push(voxel);
                }
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (!window.gameMode) return; // Mod seÃ§ilmediyse oynatma

            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;
            velocity.y -= 9.8 * 120.0 * delta;

            if (window.gameMode === 'mobile') {
                // Mobil Hareket MantÄ±ÄŸÄ±
                if (joystickActive) {
                    const speed = 600.0;
                    // KameranÄ±n baktÄ±ÄŸÄ± aÃ§Ä±ya gÃ¶re joystick yÃ¶nÃ¼nÃ¼ ayarla
                    const angle = camera.rotation.y;
                    const fwd = -joystickData.y * speed * delta; // Ä°leri/Geri joystick
                    const side = -joystickData.x * speed * delta; // SaÄŸ/Sol joystick

                    // Trigonometri: Ä°leri gitmek + Yan gitmek
                    camera.position.x -= Math.sin(angle) * fwd + Math.cos(angle) * side;
                    camera.position.z -= Math.cos(angle) * fwd - Math.sin(angle) * side;
                }
                camera.position.y += velocity.y * delta;
                
            } else {
                // PC Hareket MantÄ±ÄŸÄ±
                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();
                if (moveForward || moveBackward) velocity.z -= direction.z * 600.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 600.0 * delta;
                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                controls.getObject().position.y += (velocity.y * delta);
            }

            // Ã‡arpÄ±ÅŸma (Basit Zemin KontrolÃ¼)
            const objY = (window.gameMode === 'mobile') ? camera.position.y : controls.getObject().position.y;
            
            if (objY < BLOCK_SIZE/2 + 10) {
                velocity.y = 0;
                if (window.gameMode === 'mobile') camera.position.y = BLOCK_SIZE/2 + 10;
                else controls.getObject().position.y = BLOCK_SIZE/2 + 10;
                canJump = true;
            }

            prevTime = time;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>

